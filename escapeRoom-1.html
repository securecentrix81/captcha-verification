<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <style>
    body {
      text-align: center;
    }
  </style>
</head>
<body>
  <h3 style="margin-bottom:0">Escape The Room</h3>
  <p style="margin:0">Use WASD/Arrow keys to move</p>
  <canvas id="canvas" style="width: 200px; height: 200px; border: 5px solid #000000;"></canvas>
  <script>
    let canvas = document.getElementById("canvas")
    canvas.width = 4000
    canvas.height = 4000
    let keys = {}
    addEventListener("keydown", (e) => {
      keys[e.key.toLowerCase()] = true
    })
    addEventListener("keyup", (e) => {
      keys[e.key.toLowerCase()] = false
    })
    let ctx = canvas.getContext("2d")
    let x = 2000
    let y = 2000
    let start = Date.now()
    let ended = false
    setInterval(() => {
      if (ended) return
      ctx.clearRect(0,0,canvas.width,canvas.height)
      if (keys.w || keys.arrowup) {
        y -= 5
      }
      if (keys.a || keys.arrowleft) {
        x -= 5
      }
      if (keys.s || keys.arrowdown) {
        y += 5
      }
      if (keys.d || keys.arrowright) {
        x += 5
      }
      if (x < 100) x = 100
      if (y < 100) y = 100
      if (x > canvas.width  - 100) x = canvas.width  - 100
      if (y > canvas.height - 100) y = canvas.height - 100
      ctx.fillStyle = "#000000"
      ctx.beginPath()
      ctx.arc(x, y, 100, 0, 6.29)
      ctx.fill()
      if (Date.now() - start > 60000) {
        ended = true
        window.parent.postMessage({type: "escapeRoom-1", pass: false, start: Date.now(), ended: true}, "*")
      }
    }, 1000/60)
    window.parent.postMessage({type: "escapeRoom-1", pass: false, start: Date.now(), ended: false}, "*")
  </script>
</body>
</html>
